function Modal(a,b){this.opts=b,this.$el=a,this.$content=this.$el.find(".js-modal-content"),this.$close=this.$el.find(".js-modal-close"),this.init()}Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$.fn.onTap=function(a){void 0!==window.ontouchend&&(this.each(function(){this._touchMoveCount=0}),this.on("touchmove",function(){this._touchMoveCount++}),this.on("touchend",function(b){this._touchMoveCount<3&&a.call(this,b),this._touchMoveCount=0}),this.on("click",function(){return!1}))};var ButtonsGroup=function(){function a(a,b){this.$els={group:a,buttons:a.find(".simple-button"),select:a.children("select"),selectedButton:null},this.$els.buttons.on("click",this.onButtonClick.bind(this)),this.$els.select.length&&this.initSelect(),b&&this.select(b[0])}return a.prototype={onButtonClick:function(a){this.select(a.currentTarget)},select:function(a,b){if(null==b&&(b=!0),this.$els.selectedButton!=a&&(this.unselect(),this.$els.selectedButton=a,$(a).addClass("selected"),b&&this.$els.select.length)){var c=$(a).index();this.$els.select[0].selectedIndex=c}},unselect:function(){$(this.$els.selectedButton).removeClass("selected")},initSelect:function(){var a=this;this.$els.select.on("change",function(b){var c=a.$els.buttons.eq(this.selectedIndex);a.select(c[0],!1),a.$els.group.trigger("selectChange",this.value)})}},a}();window.EDSA_UA={},EDSA_UA.IS_TOUCH_DEVICE=void 0!==window.ontouchend,EDSA_UA.CLICK=EDSA_UA.IS_TOUCH_DEVICE?"touchend":"click",EDSA_UA.HAS_TRANSITIONS=!1,EDSA_UA.HAS_SVG=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,EDSA_UA.IS_RETINA="devicePixelRatio"in window&&devicePixelRatio>1||"matchMedia"in window&&matchMedia("(min-resolution:144dpi)").matches;var EDSA=function(){function App(a){this.options={defaultTitle:document.title,currentState:null,advancedMenusOpened:!1,summaryOpened:!1,relativeSummary:!1,currentScrollTop:0,currentSection:{},currentChapter:1,currentParagraph:1,paragraphCount:1,chapterCount:1,forceChapterChange:!1,forceParagraphChange:!1,lastAnchorTypeChanged:"par",gestureTime:220,nextPageTapZone:25,maxTapZone:150,scrollPosition:0,backButtonUrl:!1},$.extend(this.options,a),this.$els={body:$("html, body"),window:$(window),par:$("p, .paragraph").not(".exclude"),chap:$(".chapter").not(".exclude"),lim:$(".lim").not(".exclude"),contentWrap:$("section[role=main]"),sections:$("section[role=main] section"),currentParagraph:$('[data-hook="current-paragraph"]'),paragraphCount:$('[data-hook="paragraph-count"]'),paragraphSelect:$('select[name="par"]'),anchorsWrap:$(".anchors"),anchorsButton:$(".anchors .button"),allLinks:$('a[href^="javascript:"]:not(a[href="javascript:"])'),summaryButton:$('[data-hook="toggle-summary"]'),authorWrap:$('[data-hook="author"]'),titleWrap:$('[data-hook="textTitle"]'),closeAdvancedMenuBtn:$('[data-hook="close-advanced-menu"]'),showAdvancedMenuBtn:$('[data-hook="show-advanced-menu"]'),showTextSettingsMenuBtn:$('[data-hook="show-text-settings-menu"]'),changeLineHeightBtns:$('[data-hook="change-line-height"]'),changeFontBtns:$('[data-hook="change-font"]'),changeAlignmentBtns:$('[data-hook="change-alignment"]'),toggleSubmenuBtn:$('[data-hook="toggle-submenu"]'),backLibraryBtn:$('[data-hook="back-library"]')},$(document).on("keyup",this.handleKeyup.bind(this)),this.$els.window.on("scroll resize",this.onWindowScroll.bind(this)),this.$els.paragraphSelect.on("change",this.onParagraphSelectChange.bind(this)),this.$els.anchorsButton.on(EDSA_UA.CLICK,this.onAnchorsButtonClick.bind(this)),this.$els.summaryButton.on(EDSA_UA.CLICK,this.onSummaryButtonClick.bind(this)),this.$els.sections.find(".toc-title:first,h3:first,h4:first,h5:first,h6:first").on("click",this.onHeadingClick.bind(this)),this.$els.closeAdvancedMenuBtn.on("click",this.hideAdvancedMenus.bind(this)),this.$els.showAdvancedMenuBtn.on("click",this.showAdvancedMenus.bind(this)),this.$els.showTextSettingsMenuBtn.on("click",this.showTextSettingsMenu.bind(this)),this.$els.changeLineHeightBtns.on("click",this.changeLineHeight.bind(this)),this.$els.changeFontBtns.on("click",this.changeFont.bind(this)),this.$els.changeAlignmentBtns.on("click",this.changeAlignment.bind(this)),this.$els.toggleSubmenuBtn.on("click",this.toggleSubmenu.bind(this)),$(".veil").on(EDSA_UA.CLICK,this.hideAdvancedMenus.bind(this))}return App.prototype={init:function(){this.setTitle(),this.gotoCurrentAnchor(),this.setParagraphCount(),this.setChapterCount(),this.setData(),this.initClasses(),this.handleMobileDevices(),this.initStartupHint(),this.manageBackLibrary()},handleMobileDevices:function(){if(EDSA_UA.IS_TOUCH_DEVICE){var App=this;window.scrollTo(0,1),this.$els.anchorsButton=$(".anchors"),this.$els.allLinks.on("click",function(a){return!1}),this.$els.allLinks.onTap(function(e){action=this.href.match(/javascript:(.+)/)[1],eval(action)}),this.$els.contentWrap.on("touchstart",this.onContentTouchStart.bind(this)),this.$els.contentWrap.on("touchend",this.onContentTouchEnd.bind(this)),this.$els.sections.find(".toc-title:first,h3:first,h4:first,h5:first,h6:first").onTap(this.onHeadingClick.bind(this))}},getScrollTop:function(){return window.pageYOffset||("function"==typeof this.$els.window.scrollTop?this.$els.window.scrollTop():0)},smoothScrollTo:function(a){this.$els.body.animate({scrollTop:a,duration:400})},isInTheFold:function(a){var b=a.getBoundingClientRect();return b.top<=0&&b.bottom>0?!0:!1},showNextPageHint:function(){var a=document.createElement("div");a.className="pageswipe-hint",this.$els.contentWrap.after(a),$(a).one("webkitAnimationEnd oanimationend oAnimationEnd msAnimationEnd animationend",this.onPageChangeEnded.bind(this))},showAdvancedMenus:function(a){a&&a.preventDefault(),this.options.advancedMenusOpened||(this.options.advancedMenusOpened=!0,this.options.currentScrollTop=this.getScrollTop(),this.$els.body.addClass("show-advanced-menus"))},hideAdvancedMenus:function(a){a&&a.preventDefault(),this.options.advancedMenusOpened&&(this.options.advancedMenusOpened=!1,ReadabilitySettings&&ReadabilitySettings.closeSubmenu(),this.$els.body.removeClass("show-advanced-menus submenu-opened"),this.$els.anchorsWrap.removeClass("opened"))},hideTextSettingsMenus:function(){this.$els.body.removeClass("show-font-size-menu show-line-height-menu show-font-family-menu show-alignment-menu"),this.options.textInfosOpened=!1},showTextSettingsMenu:function(a){a.preventDefault();var b=$(a.currentTarget).data("setting"),c=this.options.textInfosOpened==b;this.hideTextSettingsMenus(),c||(this.options.textInfosOpened=b,this.$els.body.addClass("show-"+b+"-menu"))},onContentTouchStart:function(a){return"A"===a.target.tagName?!0:(this.gestureStartTime=new Date,this.gestureStartPosition=a.originalEvent.changedTouches[0].clientY,this.gestureStartScreenPosition=this.$els.window.scrollTop(),void this.$els.body.stop())},onContentTouchEnd:function(a){this.gestureEndTime=new Date,this.gestureEndPosition=a.originalEvent.changedTouches[0].clientY;var b=this.gestureEndTime-this.gestureStartTime,c=this.gestureEndPosition-this.gestureStartPosition,d=c/b;if(b<=this.options.gestureTime){var e=.75*window.innerHeight,f=this.getTapZone();(!d||15>c)&&(this.gestureEndPosition>=f&&!this.options.summaryOpened?(this.showNextPageHint(),this.smoothScrollTo(this.gestureStartScreenPosition+e)):this.showAdvancedMenus())}},getTapZone:function(){var a=window.innerHeight,b=a*(this.options.nextPageTapZone/100),c=this.options.maxTapZone,d=b>c?c:b;return a-d},onPageChangeEnded:function(a){$(".pageswipe-hint").remove()},onSummaryButtonClick:function(a){this.options.summaryOpened?this.closeSummary():this.openSummary()},openSummary:function(){this.options.scrollPosition=this.getScrollTop(),this.$els.body.addClass("show-summary"),this.options.summaryOpened=!0,this.$els.window.scrollTop(0)},closeSummary:function(){this.$els.body.removeClass("show-summary"),this.options.summaryOpened=!1,this.$els.window.scrollTop(this.options.scrollPosition)},onHeadingClick:function(a){var b,c,d,e;this.options.summaryOpened&&(b=$(a.currentTarget),c=b.parents("section"),d=this.$els.sections.index(c),e=this.getAnchorTypeAndNumberMatchesFromEl(c[0]),this.closeSummary(),this.hideAdvancedMenus(),this.gotoAnchorFromMatches(e))},handleKeyup:function(a){var b,c;b={escape:27},c=a.keyCode?a.keyCode:a.which,c==b.escape&&(ReadabilitySettings.get("submenuOpened")?ReadabilitySettings.closeSubmenu():this.hideAdvancedMenus())},onWindowScroll:function(a){var b,c,d;return b=this,c=this.getScrollTop(),d=null,this.$els.sections.each(function(a,c){return b.isInTheFold(c)?(d=c,b.setCurrentSection(b.getAnchorTypeAndNumberMatchesFromEl(c)),void $(c).children("p, .paragraph").not(".exclude").each(function(a,c){return b.isInTheFold(c)?(d=c,void b.setCurrentParagraph(b.getAnchorTypeAndNumberMatchesFromEl(c).number)):!0})):!0}),null==d?(this.clearState(),this.setCurrentChapter(1),void this.setCurrentParagraph(1)):(matches=this.getAnchorTypeAndNumberMatchesFromEl(d),void this.replaceStateFromMatches(matches,!1))},onAnchorsButtonClick:function(a){this.$els.anchorsWrap.toggleClass("opened"),this.$els.body.toggleClass("submenu-opened")},onParagraphSelectChange:function(a){var b=a.currentTarget.value;this.replaceState(this.options.lastAnchorTypeChanged,b,!0)},getAnchorTypeAndNumberMatchesFromHref:function(a){var b=a.match(/(lim|par|chap)(\-)([0-9]+)/);return null==b?null:{type:b[1],number:b[3]}},getAnchorTypeAndNumberMatchesFromEl:function(a){var b=$(a).data("type");return b?{type:b,number:this.$els[b].index(a)+1}:null},gotoAnchor:function(a,b){var c,d;c=$(this.$els[a][b-1]),d=c.offset().top,this.$els.window.scrollTop(d),document.title=this.options.defaultTitle+" | "+a.capitalize()+" "+b},gotoAnchorFromMatches:function(a){null!=a&&this.gotoAnchor(a.type,a.number)},gotoCurrentAnchor:function(){var a,b;a=window.location.href,b=this.getAnchorTypeAndNumberMatchesFromHref(a),null!=b&&this.gotoAnchorFromMatches(b)},replaceState:function(a,b,c){if(!this.options.currentState||this.options.currentState.type!=a||this.options.currentState.number!=b){var d,e,f;d={type:a,number:b},e=this.options.defaultTitle+" | "+a.capitalize()+" "+b,f="#"+a+"-"+b,window.history.replaceState(d,e,f),this.options.currentState=d,c?this.gotoAnchor(a,b):document.title=e}},replaceStateFromMatches:function(a,b){null!=a&&this.replaceState(a.type,a.number,b)},clearState:function(){if(null!=this.options.currentState){this.options.currentState=null;var a,b,c;a={},b=this.options.defaultTitle,c="#",window.history.replaceState(a,b,c),document.title=b}},setCurrentSection:function(a){var b,c;b=a.type==this.options.currentSection.type,c=a.number==this.options.currentSection.number,b&&c||(this.options.currentSection=a,"chap"==a.type?this.setCurrentChapter(a.number):this.setCurrentChapter(1))},setCurrentChapter:function(a){var b,c,d;b=a==this.options.currentChapter,(!b||this.options.forceChapterChange)&&(d=$(this.$els.paragraphSelect.find("optgroup")[parseInt(a)+1]),c=d.find("option").first().val(),this.options.currentChapter=a,this.options.forceChapterChange=!1,this.setCurrentParagraph(c))},setCurrentParagraph:function(a){var b=a==this.options.currentParagraph;(!b||this.options.forceParagraphChange)&&(this.options.currentParagraph=a,this.options.forceParagraphChange=!1,this.$els.currentParagraph.html(a),this.$els.paragraphSelect[0].options.selectedIndex=a-1)},setParagraphCount:function(a){null==a&&(a=$("p, .paragraph").not(".exclude").length),a!=this.options.paragraphCount&&(this.options.paragraphCount=a,this.setAnchorSelect(),this.$els.paragraphCount.html(a))},setChapterCount:function(a){null==a&&(a=this.$els.chap.length),a!=this.options.chapterCount&&(this.options.chapterCount=a)},setAnchorSelect:function(){var a="",b=1;this.$els.sections.each(function(c,d){var e=$(d),f=e.find("h1, h2, h3").first().text(),g=e.find("p, .paragraph").not(".exclude").length,h=0;for(a+='<optgroup label="'+f+'">';g>h;)a+='<option value="'+b+'">'+b+"</option>",h++,b++;a+="</optgroup>"}),this.$els.paragraphSelect.html(a)},setData:function(){var a=this;$.each(["lim","par","chap"],function(b,c){a.$els[c].data("type",c)})},setTitle:function(){var a=this.$els.contentWrap.find(".author").text(),b=this.$els.contentWrap.find(".title").text();this.options.defaultTitle=a+" - "+b,document.title=this.options.defaultTitle,this.$els.authorWrap.text(a),this.$els.titleWrap.text(b)},changeSiblingAnchorSelect:function(a,b,c){a.options.selectedIndex=b-1,this.options.forceChapterChange=!0,this.options.forceParagraphChange=!0,this.options.lastAnchorTypeChanged=c},initClasses:function(){this.options.relativeSummary&&this.$els.body.addClass("relative-summary")},initStartupHint:function(){if(EDSA_UA.IS_TOUCH_DEVICE){var a=$.parseJSON(localStorage.getItem("edsa"));($.isEmptyObject(a)||1==a.firstVisit)&&(localStorage.setItem("edsa",JSON.stringify({firstVisit:!1})),this.startupHint=new Modal($(".js-startup-hint"),{openCallback:function(){this.$els.body.addClass("show-startup-hint"),document.ontouchmove=function(a){a.preventDefault()}}.bind(this),closeCallback:function(){this.$els.body.removeClass("show-startup-hint"),document.ontouchmove=function(a){return!0}}.bind(this)}))}},changeLineHeight:function(a){a.preventDefault();var b=$(a.currentTarget).data("line-height");ReadabilitySettings.setLineHeight(b)},changeFont:function(a){a.preventDefault();var b=$(a.currentTarget).data("font-direction");ReadabilitySettings.cycleFont(b)},changeAlignment:function(a){a.preventDefault();var b=$(a.currentTarget).data("alignment");ReadabilitySettings.setAlignment(b)},toggleSubmenu:function(a){a.preventDefault(),ReadabilitySettings.toggleSubmenu()},manageBackLibrary:function(){this.options.backButtonUrl?this.$els.backLibraryBtn.attr("href",this.options.backButtonUrl):document.referrer?this.$els.backLibraryBtn.on("click",this.handleBackLibrary.bind(this)):this.$els.backLibraryBtn.hide()},handleBackLibrary:function(a){a.preventDefault(),window.history.back()}},App}();Modal.prototype={init:function(){this.$close.on("click",function(){this.close()}.bind(this)),this.$el.on("click",function(){this.close()}.bind(this)),this.$content.on("click",function(a){a.stopImmediatePropagation()}),this.open()},close:function(){this.$el.addClass("hidden"),this.opts.closeCallback&&this.opts.closeCallback()},open:function(){this.$el.removeClass("hidden"),this.opts.openCallback&&this.opts.openCallback()}};var ReadabilitySettings=function(){function a(){this.options={submenuOpened:!1,fontSize:{"default":0,current:0},lineHeight:{"default":0,current:0},alignment:{"default":null,current:null},theme:{"default":null,current:null},fontFamily:{"default":null,current:null}},this.$els={body:$("body"),main:$('[role="main"]'),veil:$(".veil"),fontSizeButtons:$(".font-size a"),lineHeightButtons:$(".line-height a"),alignmentButtons:$(".alignment a"),fontFamilyPrev:$(".js-prev-font"),fontFamilyNext:$(".js-next-font"),fontFamilyExample:$(".js-font-example"),fontFamilyName:$(".js-font-name"),fontFamilyChoices:$(".js-font-choices")};var a=window.getComputedStyle(this.$els.main[0]);this.initialStyles={fontSize:parseInt(a.getPropertyValue("font-size")),lineHeight:parseInt(a.getPropertyValue("line-height")),alignment:a.getPropertyValue("text-align"),theme:this.$els.body[0].className.match(/theme-([a-zA-Z0-9]+)/)[1],fontFamily:this.$els.main[0].className.match(/font-([a-zA-Z0-9]+)/)[1]},this.init()}return a.prototype={init:function(){$.each(this.initialStyles,function(a,b){this.setInitialOption(a,b)}.bind(this)),this.applySavedSettings(),this.initAlignmentButtonsGroup(),this.initThemeSlider(),this.initFontSizeButtons(),EDSA_UA.IS_TOUCH_DEVICE?this.$els.veil.onTap(this.closeSubmenu.bind(this)):this.$els.veil.on("click",this.closeSubmenu.bind(this))},initFontSizeButtons:function(){$("[data-font-size]").on("click",function(a){a.preventDefault();var b=$(a.currentTarget);this.setFontSize(b.data("font-size"))}.bind(this))},applySavedSettings:function(){var a=JSON.parse(localStorage.getItem("readabilitySettings"));a&&(this.setFontSize(a.fontSize),this.setLineHeight(a.lineHeight),this.setAlignment(a.alignment),this.setFontFamily(a.fontFamily),this.setTheme(a.theme))},get:function(a){return this.options[a]},setInitialOption:function(a,b){b&&("lineHeight"==a&&(b=this.getRoundedLineHeight(b)),this.options[a]["default"]=b,this.options[a].current=b)},toggleSubmenu:function(){this.options.submenuOpened?this.closeSubmenu():this.openSubmenu()},openSubmenu:function(){this.options.submenuOpened||(this.options.submenuOpened=!0,this.$els.body.addClass("show-readability-settings submenu-opened"))},closeSubmenu:function(){this.options.submenuOpened&&(this.options.submenuOpened=!1,this.$els.body.removeClass("show-readability-settings submenu-opened"))},largerFontSize:function(){this.changeFontSize(1)},smallerFontSize:function(){this.changeFontSize(-1)},normalFontSize:function(){this.setFontSize(this.options.fontSize["default"])},changeFontSize:function(a){var b=this.options.fontSize.current+a;this.setFontSize(b)},setFontSize:function(a){a&&(this.$els.fontSizeButtons.removeClass("active"),this.$els.fontSizeButtons.filter('[data-font-size="'+a.toString()+'"]').addClass("active"),this.options.fontSize.current==a||a>3||(this.options.fontSize.current=a,this.updateLocalStorage("fontSize",a),this.$els.main.css("font-size",a+"em")))},largerLineHeight:function(){this.changeLineHeight(1)},smallerLineHeight:function(){this.changeLineHeight(-1)},normalLineHeight:function(){this.setLineHeight(this.options.lineHeight["default"])},getRoundedLineHeight:function(a){var b;return a/=this.options.fontSize["default"],b=Math.round(10*a)/10},changeLineHeight:function(a){var b=(10*this.options.lineHeight.current+a)/10;this.setLineHeight(b)},setLineHeight:function(a){a&&(this.$els.lineHeightButtons.removeClass("active"),this.$els.lineHeightButtons.filter(".line-height-"+10*a).addClass("active"),this.options.lineHeight.current!=a&&(this.options.lineHeight.current=a,this.updateLocalStorage("lineHeight",a),this.$els.main.css("line-height",a)))},leftAlignment:function(){this.setAlignment("left")},justifyAlignment:function(){this.setAlignment("justify")},initAlignmentButtonsGroup:function(){var a,b,c;b=$(".alignments"),c=b.find(".alignment-"+this.options.alignment.current),a=new ButtonsGroup(b,c)},setAlignment:function(a){if(a&&(this.$els.alignmentButtons.removeClass("active"),this.$els.alignmentButtons.filter(".alignment-"+a).addClass("active"),this.options.alignment.current!=a)){var b=this.options.alignment.current;this.options.alignment.current=a,this.updateLocalStorage("alignment",a),this.$els.main.removeClass("align-"+b),this.$els.main.addClass("align-"+a)}},updateLocalStorage:function(a,b){var c=JSON.parse(localStorage.getItem("readabilitySettings"))||{};c[a]=b,localStorage.setItem("readabilitySettings",JSON.stringify(c))},initThemeSlider:function(){var a=this.setTheme.bind(this);$(".slider-container .slider").slider({value:this.options.theme.current,min:1,max:5,step:1,slide:function(b,c){a(c.value)}})},setTheme:function(a){if(a&&this.options.theme.current!=a){var b=this.options.theme.current;this.options.theme.current=a,this.updateLocalStorage("theme",a),this.$els.body.removeClass("theme-"+b),this.$els.body.addClass("theme-"+a)}},fontFamily:function(a){this.setFontFamily(a)},initFontFamilyButtonsGroup:function(){var a,b,c,d;a=this,c=$(".buttons-group.fonts"),d=c.find(".font-"+this.options.fontFamily.current),c.on("selectChange",function(b,c){a.fontFamily(c)}),b=new ButtonsGroup(c,d)},setFontFamily:function(a){if(a){var b=this.options.fontFamily.current;this.options.fontFamily.current=a,this.updateFontFamilyPreviewer(b,a),b!=a&&(this.updateLocalStorage("fontFamily",a),this.$els.main.removeClass("font-"+b),this.$els.main.addClass("font-"+a))}},cycleFont:function(a){this.retrieveFontFamilyNode(this.options.fontFamily.current);var b=this.retrieveFontFamilyNode(this.options.fontFamily.current).index(),c=this.$els.fontFamilyChoices.find("option"),d=b+a;targetIndex=d>c.length-1?0:d,targetOption=c.eq(targetIndex),this.setFontFamily(targetOption.attr("value"))},nextFont:function(){this.cycleFont(1)},prevFont:function(){this.cycleFont(-1)},retrieveFontFamilyNode:function(a){var b='option[value="'+a+'"]';return this.$els.fontFamilyChoices.find(b)},retrieveFontFamilyDisplayName:function(a){return this.retrieveFontFamilyNode(a).text()},updateFontFamilyPreviewer:function(a,b){this.$els.fontFamilyExample.removeClass("font-"+a),this.$els.fontFamilyExample.addClass("font-"+b),this.$els.fontFamilyName.text(this.retrieveFontFamilyDisplayName(b))}},a}();window.ReadabilitySettings=new ReadabilitySettings;